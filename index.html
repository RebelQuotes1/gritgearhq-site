<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Grit Gear HQ – Survival Field Guides & Real-World Preparedness</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="description" content="Digital-first survival field guides + practical gear picks that hold up when life gets real. Readiness without paranoia." />
  <meta name="theme-color" content="#050608" />

  <!-- Open Graph -->
  <meta property="og:title" content="Grit Gear HQ – Prepared, Not Paranoid" />
  <meta property="og:description" content="Digital-first survival field guides + practical gear picks that hold up when life gets real." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://gritgearhq.com/" />

  <!-- Google Ads (keep only ONE instance – keep your client id) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1532367766505583" crossorigin="anonymous"></script>

  <style>
    /* =========================================================
       TOKENS
    ========================================================= */
    :root{
      --bg:#050608;
      --bg2:#0b0f15;
      --panel:#121823;
      --panel2:#171f2b;
      --stroke:rgba(255,255,255,.08);
      --ink:#e7ecef;
      --muted:rgba(231,236,239,.72);
      --soft:rgba(231,236,239,.12);

      --accent:#f8aa36;
      --accent2:#f1870a;

      --r:18px;
      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --shadow2: 0 8px 30px rgba(0,0,0,.45);

      --max: 1280px;
      --gap: 18px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background:
        radial-gradient(900px 450px at 20% -10%, rgba(248,170,54,.10), transparent 65%),
        radial-gradient(900px 450px at 80% 0%, rgba(241,135,10,.08), transparent 60%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      color:var(--ink);
      line-height:1.35;
    }

    a{color:inherit; text-decoration:none}
    .wrap{max-width:var(--max); margin:0 auto; padding:18px 16px 40px;}

    /* =========================================================
       TOP BAR
    ========================================================= */
    .topbar{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(10px);
      background: rgba(5,6,8,.72);
      border-bottom: 1px solid var(--stroke);
    }
    .topbar-inner{
      max-width:var(--max);
      margin:0 auto;
      padding:12px 16px;
      display:flex; align-items:center; gap:12px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      min-width: 220px;
    }
    .logo{
      width:36px; height:36px; border-radius:12px;
      background:
        radial-gradient(12px 12px at 30% 25%, rgba(255,255,255,.18), transparent 60%),
        linear-gradient(135deg, rgba(248,170,54,.85), rgba(241,135,10,.55));
      box-shadow: 0 10px 35px rgba(248,170,54,.14);
      border: 1px solid rgba(255,255,255,.08);
    }
    .brand h1{
      margin:0; font-size:14px; letter-spacing:.4px;
      text-transform:uppercase;
    }
    .brand .tag{
      margin:2px 0 0; font-size:12px; color:var(--muted);
    }

    .nav{
      display:flex; gap:10px; flex-wrap:wrap;
      margin-left:auto;
      align-items:center;
    }
    .pill{
      font-size:12px;
      padding:9px 10px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.03);
    }
    .pill:hover{border-color: rgba(248,170,54,.35)}
    .cta{
      font-weight:700;
      border-color: rgba(248,170,54,.45);
      background: linear-gradient(180deg, rgba(248,170,54,.18), rgba(255,255,255,.04));
    }

    /* =========================================================
       DESKTOP HIERARCHY LAYOUT
       LEFT (gear wall) | CENTER (brain) | RIGHT (lifestyle proof)
    ========================================================= */
    .grid{
      margin-top:18px;
      display:grid;
      grid-template-columns: 320px 1fr 320px;
      gap: var(--gap);
      align-items:start;
    }

    /* Side columns: sticky scroll wells on desktop */
    .side{
      position: sticky;
      top: 76px;
      max-height: calc(100vh - 96px);
      overflow:auto;
      padding-right: 6px;
    }
    .side::-webkit-scrollbar{width:8px}
    .side::-webkit-scrollbar-thumb{background: rgba(255,255,255,.08); border-radius:999px}
    .side::-webkit-scrollbar-track{background: transparent}

    .center{
      min-height: 65vh;
    }

    /* =========================================================
       CARD + MODULES
    ========================================================= */
    .card{
      background: linear-gradient(180deg, rgba(18,24,35,.95), rgba(11,15,21,.92));
      border: 1px solid var(--stroke);
      border-radius: var(--r);
      box-shadow: var(--shadow2);
      overflow:hidden;
    }
    .card + .card{margin-top: var(--gap)}
    .card-h{
      padding:12px 14px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      border-bottom:1px solid rgba(255,255,255,.06);
      background: rgba(255,255,255,.02);
    }
    .kicker{
      display:inline-flex; align-items:center; gap:8px;
      font-size:11px;
      letter-spacing:.9px;
      text-transform:uppercase;
      color: rgba(248,170,54,.9);
    }
    .kdot{
      width:8px; height:8px; border-radius:999px;
      background: rgba(248,170,54,.9);
      box-shadow: 0 0 16px rgba(248,170,54,.35);
    }
    .meta{
      font-size:11px;
      color: var(--muted);
    }
    .card-b{padding:14px}

    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      gap:10px;
      padding:11px 14px;
      border-radius: 12px;
      border: 1px solid rgba(248,170,54,.35);
      background: linear-gradient(180deg, rgba(248,170,54,.20), rgba(241,135,10,.10));
      color: var(--ink);
      font-weight:800;
      cursor:pointer;
      user-select:none;
    }
    .btn:hover{transform: translateY(-1px)}
    .btn:active{transform: translateY(0px)}
    .btn.secondary{
      border-color: rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      font-weight:700;
    }

    /* =========================================================
       HERO (CENTERPIECE ABOVE FOLD)
    ========================================================= */
    .hero{
      padding:22px 18px;
      background:
        radial-gradient(700px 240px at 50% 0%, rgba(248,170,54,.14), transparent 70%),
        linear-gradient(180deg, rgba(255,255,255,.03), transparent 55%);
    }
    .hero h2{
      margin:0 0 8px;
      font-size: 28px;
      letter-spacing:.2px;
    }
    .hero p{
      margin:0;
      color: var(--muted);
      font-size: 14px;
      max-width: 62ch;
    }
    .hero-actions{
      margin-top:14px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .hero-strip{
      margin-top:14px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      color: rgba(231,236,239,.76);
      font-size:12px;
    }
    .chip{
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
    }

    /* =========================================================
       CONTENT STACK (CENTER)
    ========================================================= */
    .stack{display:grid; gap: var(--gap); margin-top: var(--gap);}
    .two{
      display:grid; gap: var(--gap);
      grid-template-columns: 1fr 1fr;
    }

    .truth{
      border-left: 3px solid rgba(248,170,54,.75);
      padding-left:12px;
      margin: 10px 0;
      color: rgba(231,236,239,.9);
      font-weight:650;
    }
    .muted{color:var(--muted)}
    .bullets{margin:10px 0 0; padding-left:18px; color: rgba(231,236,239,.86)}
    .bullets li{margin:6px 0}

    /* =========================================================
       ROTATOR (for your existing rotating cards)
       This is a simple "slot" system.
    ========================================================= */
    .slot-note{
      margin:8px 0 0;
      padding:10px 12px;
      border-radius: 12px;
      border: 1px dashed rgba(248,170,54,.35);
      color: rgba(231,236,239,.70);
      font-size: 12px;
      background: rgba(255,255,255,.02);
    }

    /* =========================================================
       FIELD NOTES BOARD (MESSAGE BOARD)
    ========================================================= */
    .board-grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--gap);
    }
    .form-row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    label{
      display:block;
      font-size:12px;
      color: rgba(231,236,239,.78);
      margin: 10px 0 6px;
    }
    input, select, textarea{
      width:100%;
      padding: 11px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.25);
      color: var(--ink);
      outline:none;
    }
    textarea{min-height: 120px; resize: vertical;}
    input:focus, select:focus, textarea:focus{
      border-color: rgba(248,170,54,.45);
      box-shadow: 0 0 0 4px rgba(248,170,54,.10);
    }

    .board-list{
      display:grid;
      gap: 12px;
    }
    .post{
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
    }
    .post-top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 6px;
    }
    .post h4{margin:0; font-size: 14px}
    .badge{
      font-size: 11px;
      padding: 6px 9px;
      border-radius: 999px;
      border: 1px solid rgba(248,170,54,.30);
      color: rgba(248,170,54,.95);
      background: rgba(248,170,54,.08);
      white-space:nowrap;
    }
    .post .small{
      font-size: 12px;
      color: rgba(231,236,239,.76);
      margin: 6px 0 0;
    }
    .post .body{
      margin-top: 8px;
      color: rgba(231,236,239,.86);
      font-size: 13px;
      white-space: pre-wrap;
    }
    .post-actions{
      display:flex; gap: 8px; flex-wrap:wrap;
      margin-top: 10px;
    }
    .tiny{
      font-size: 12px;
      padding: 9px 10px;
      border-radius: 12px;
    }

    .divider{
      height:1px; background: rgba(255,255,255,.06);
      margin: 12px 0;
    }

    /* =========================================================
       RESPONSIVE
    ========================================================= */
    @media (max-width: 1080px){
      .grid{grid-template-columns: 300px 1fr 300px;}
    }
    @media (max-width: 980px){
      .grid{grid-template-columns: 1fr;}
      .side{
        position: relative;
        top:auto;
        max-height:none;
        overflow: visible;
        padding-right:0;
      }
      .two{grid-template-columns: 1fr;}
      .board-grid{grid-template-columns: 1fr;}
      .brand{min-width: 0}
    }
  </style>
</head>

<body>
  <!-- TOP BAR -->
  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand" aria-label="Grit Gear HQ">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>GRIT GEAR HQ</h1>
          <div class="tag">Prepared, not paranoid.</div>
        </div>
      </div>

      <nav class="nav" aria-label="Site">
        <a class="pill" href="#guides">Field Guides</a>
        <a class="pill" href="#gear">Gear Picks</a>
        <a class="pill" href="#apparel">Apparel</a>
        <a class="pill cta" href="#field-notes">Field Notes</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <section class="grid">

      <!-- ======================================================
           LEFT: PRACTICAL GEAR WALL (affiliate/visual-first)
           KEEP 100% of your existing gear content by pasting
           your current gear cards/rotators into #leftGearSlot
      ======================================================= -->
      <aside class="side" aria-label="Gear picks" id="gear">
        <div class="card">
          <div class="card-h">
            <div class="kicker"><span class="kdot"></span> Gear Picks</div>
            <div class="meta">Practical • Tested vibe</div>
          </div>
          <div class="card-b">
            <!-- PASTE YOUR EXISTING LEFT COLUMN GEAR ROTATORS/CARDS HERE -->
            <div id="leftGearSlot">
              <div class="slot-note">
                <b>Paste your existing Gear cards here.</b><br>
                Keep them exactly as-is. This layout makes them behave like a "gear wall" on desktop.
              </div>
            </div>
          </div>
        </div>

        <!-- OPTIONAL: ad container styled like a card (won't feel like an interrupt) -->
        <div class="card">
          <div class="card-h">
            <div class="kicker"><span class="kdot"></span> Sponsor</div>
            <div class="meta">Styled placement</div>
          </div>
          <div class="card-b">
            <!-- If you use AdSense display ads, place the INS block here. -->
            <div class="slot-note">
              Optional: place an AdSense display unit here so it looks native, not like an interruption.
            </div>
          </div>
        </div>
      </aside>


      <!-- ======================================================
           CENTER: THE BRAIN (hero + digital guides + philosophy + community)
      ======================================================= -->
      <section class="center" aria-label="Main content">

        <!-- HERO ABOVE THE FOLD -->
        <div class="card hero" role="region" aria-label="Prepared, not paranoid">
          <h2>Prepared, Not Paranoid.</h2>
          <p>
            Digital-first survival field guides + gear picks for people who want calm, functional readiness
            when life gets real. No theatrics. No cosplay. Just practical.
          </p>

          <div class="hero-actions">
            <a class="btn" href="#guides">Start with a Field Guide →</a>
            <a class="btn secondary" href="#field-notes">Read Field Notes →</a>
          </div>

          <div class="hero-strip">
            <span class="chip">Decision-making under pressure</span>
            <span class="chip">Low-drama preparedness</span>
            <span class="chip">Gear that holds up</span>
          </div>
        </div>

        <div class="stack">
          <!-- DIGITAL GUIDES (PRIMARY SALE) -->
          <div class="card" id="guides">
            <div class="card-h">
              <div class="kicker"><span class="kdot"></span> Field Guides</div>
              <div class="meta">Digital • High margin • Your centerpiece</div>
            </div>
            <div class="card-b">
              <!-- PASTE YOUR EXISTING DIGITAL GUIDE CARDS/SECTIONS HERE -->
              <div id="digitalGuidesSlot">
                <div class="slot-note">
                  <b>Paste your existing Digital Guides content here.</b><br>
                  Keep 100% of it. This center column is now the hero on desktop (wider, calmer).
                </div>
              </div>
            </div>
          </div>

          <!-- TRUTH / PHILOSOPHY (short blocks, not essays) -->
          <div class="two">
            <div class="card">
              <div class="card-h">
                <div class="kicker"><span class="kdot"></span> The Mind</div>
                <div class="meta">Readiness first</div>
              </div>
              <div class="card-b">
                <div class="truth">Truth: Most people fail before the “decision point.”</div>
                <p class="muted" style="margin:0">
                  Gear is backup. Judgment is primary. If your head locks up, your pack doesn’t matter.
                </p>
                <ul class="bullets">
                  <li>Recognize delay + cognitive friction</li>
                  <li>Stop “perfect plan” paralysis</li>
                  <li>Choose the next right move</li>
                </ul>
              </div>
            </div>

            <div class="card">
              <div class="card-h">
                <div class="kicker"><span class="kdot"></span> The Rule</div>
                <div class="meta">Simple, repeatable</div>
              </div>
              <div class="card-b">
                <div class="truth">Truth: Calm is a skill — not a personality.</div>
                <p class="muted" style="margin:0">
                  You don’t rise to the occasion. You fall to your training.
                </p>
                <ul class="bullets">
                  <li>Keep your decisions small & fast</li>
                  <li>Prevent compounding mistakes</li>
                  <li>Spend energy where it actually helps</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- ======================================================
               FIELD NOTES (MESSAGE BOARD)
               WORKS NOW: submit -> pending queue -> approve -> publish
               (stored in visitor browser localStorage)
               For real multi-user publishing, see "Backend Upgrade" note below
          ======================================================= -->
          <div class="card" id="field-notes">
            <div class="card-h">
              <div class="kicker"><span class="kdot"></span> Field Notes</div>
              <div class="meta">Survival stories • Lessons learned • What actually worked</div>
            </div>
            <div class="card-b">

              <p class="muted" style="margin:0 0 10px">
                This is a field notebook, not social media. Keep it useful. No politics. No macho fantasies.
                Real experiences or practical knowledge only.
              </p>

              <div class="board-grid">
                <!-- SUBMIT -->
                <div>
                  <h3 style="margin:0 0 8px; font-size:16px;">Submit a Field Note</h3>

                  <label for="fnType">Post type</label>
                  <select id="fnType">
                    <option>Survival Story</option>
                    <option>Mistake Made</option>
                    <option>Lesson Learned</option>
                    <option>Gear That Failed</option>
                    <option>What Actually Worked</option>
                  </select>

                  <div class="form-row">
                    <div>
                      <label for="fnName">Name (or call sign)</label>
                      <input id="fnName" placeholder="e.g., RidgeRunner" maxlength="32" />
                    </div>
                    <div>
                      <label for="fnLocation">Location (optional)</label>
                      <input id="fnLocation" placeholder="e.g., Rural Arkansas" maxlength="40" />
                    </div>
                  </div>

                  <label for="fnTitle">Title</label>
                  <input id="fnTitle" placeholder="Short + specific (what happened?)" maxlength="70" />

                  <label for="fnBody">Field Note (use this format)</label>
                  <textarea id="fnBody" placeholder=
"Scenario:
What went wrong:
What worked:
Lesson:"
                  ></textarea>

                  <div class="form-row">
                    <button class="btn tiny" id="submitNoteBtn" type="button">Submit for approval →</button>
                    <button class="btn secondary tiny" id="clearFormBtn" type="button">Clear</button>
                  </div>

                  <div class="slot-note" style="margin-top:12px;">
                    <b>Moderation:</b> Submissions go to a <i>Pending</i> queue. Approve them with the Admin button (below).
                    <br><br>
                    <b>Note:</b> This version stores posts in the visitor’s browser (localStorage). For true site-wide posts,
                    use the backend upgrade notes in the footer.
                  </div>
                </div>

                <!-- READ -->
                <div>
                  <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
                    <h3 style="margin:0; font-size:16px;">Published Notes</h3>
                    <div style="display:flex; gap:8px; flex-wrap:wrap;">
                      <button class="btn secondary tiny" id="filterAllBtn" type="button">All</button>
                      <button class="btn secondary tiny" id="filterUsefulBtn" type="button">Most useful</button>
                      <button class="btn secondary tiny" id="openAdminBtn" type="button">Admin</button>
                    </div>
                  </div>

                  <div class="divider"></div>

                  <div class="board-list" id="publishedList" aria-live="polite"></div>

                  <div class="divider"></div>

                  <h3 style="margin:0 0 8px; font-size:16px;">Pending (approval queue)</h3>
                  <div class="board-list" id="pendingList"></div>
                </div>
              </div>

            </div>
          </div>

          <!-- CENTER EXTRA SLOT (KEEP 100% OF YOUR EXISTING CENTER CONTENT) -->
          <div class="card">
            <div class="card-h">
              <div class="kicker"><span class="kdot"></span> More from Grit Gear HQ</div>
              <div class="meta">Keep everything — just organized</div>
            </div>
            <div class="card-b">
              <!-- PASTE ANY OTHER EXISTING CENTER CONTENT SECTIONS HERE -->
              <div id="centerExtrasSlot">
                <div class="slot-note">
                  Paste any additional center content you already have (quotes, features, sections, etc.) here.
                  Nothing gets deleted — this is where the “extra” center pieces live without cluttering the hero.
                </div>
              </div>
            </div>
          </div>

        </div>
      </section>


      <!-- ======================================================
           RIGHT: LIFESTYLE PROOF (apparel, what we wear)
           Keep 100% of existing apparel cards by pasting into #rightApparelSlot
      ======================================================= -->
      <aside class="side" aria-label="Apparel" id="apparel">
        <div class="card">
          <div class="card-h">
            <div class="kicker"><span class="kdot"></span> Apparel</div>
            <div class="meta">Lifestyle proof</div>
          </div>
          <div class="card-b">
            <!-- PASTE YOUR EXISTING APPAREL ROTATORS/CARDS HERE -->
            <div id="rightApparelSlot">
              <div class="slot-note">
                <b>Paste your existing Apparel cards here.</b><br>
                This column stays clean: apparel only. It reinforces identity and trust.
              </div>
            </div>
          </div>
        </div>

        <!-- OPTIONAL: any existing right-column extras (keep 100%) -->
        <div class="card">
          <div class="card-h">
            <div class="kicker"><span class="kdot"></span> Extras</div>
            <div class="meta">Keep 100% content</div>
          </div>
          <div class="card-b">
            <div id="rightExtrasSlot">
              <div class="slot-note">
                Paste any existing right-side sections here (as-is).
              </div>
            </div>
          </div>
        </div>
      </aside>

    </section>

    <footer style="margin-top:22px; color:rgba(231,236,239,.65); font-size:12px;">
      <div class="divider"></div>
      <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:space-between; align-items:center;">
        <div>© <span id="year"></span> Serpico • Grit Gear HQ</div>
        <div class="muted">“Civilization is an illusion. Grit is currency.”</div>
      </div>

      <div style="margin-top:10px; padding:12px 14px; border:1px solid rgba(255,255,255,.08); border-radius:14px; background:rgba(255,255,255,.03);">
        <b>Backend upgrade for true public Field Notes (site-wide):</b><br>
        This demo uses browser storage. To make Field Notes shared across all visitors, plug the same UI into:
        <ul class="bullets">
          <li><b>Fastest “no-server” approach:</b> Netlify Forms (submit to your email) + you manually post curated notes.</li>
          <li><b>Best scalable approach:</b> Supabase or Firebase (store posts + admin approval + public feed).</li>
        </ul>
      </div>
    </footer>
  </main>

  <script>
    // =========================================================
    // BASIC UTIL
    // =========================================================
    document.getElementById("year").textContent = new Date().getFullYear();

    const LS_KEYS = {
      published: "grit_fieldnotes_published_v1",
      pending: "grit_fieldnotes_pending_v1",
      usefulSort: "grit_fieldnotes_sort_useful_v1",
      admin: "grit_fieldnotes_admin_ok_v1"
    };

    const nowISO = () => new Date().toISOString();
    const uid = () => Math.random().toString(16).slice(2) + "-" + Date.now().toString(16);

    function loadLS(key, fallback){
      try{
        const raw = localStorage.getItem(key);
        if(!raw) return fallback;
        return JSON.parse(raw);
      }catch(e){
        return fallback;
      }
    }
    function saveLS(key, value){
      localStorage.setItem(key, JSON.stringify(value));
    }

    // Seed with a couple example posts (you can delete these later)
    function ensureSeed(){
      const pub = loadLS(LS_KEYS.published, []);
      const pen = loadLS(LS_KEYS.pending, []);
      if(pub.length === 0 && pen.length === 0){
        const seed = [
          {
            id: uid(),
            type: "Lesson Learned",
            name: "RidgeRunner",
            location: "Ozarks",
            title: "I lost 30 minutes to indecision in a storm",
            body: "Scenario:\nUnexpected storm hit while I was 'almost ready.'\n\nWhat went wrong:\nI kept optimizing instead of moving. I wanted perfect.\n\nWhat worked:\nI forced a 2-minute decision rule: shelter first, then heat.\n\nLesson:\nSmall fast decisions beat perfect plans.",
            createdAt: nowISO(),
            useful: 6
          },
          {
            id: uid(),
            type: "Gear That Failed",
            name: "LowDramaPrep",
            location: "",
            title: "Cheap headlamp died at the worst time",
            body: "Scenario:\nPower out for 8 hours.\n\nWhat went wrong:\nBargain batteries + cold.\n\nWhat worked:\nBackup light + lithium AAs.\n\nLesson:\nTest gear in the conditions you expect, not in your living room.",
            createdAt: nowISO(),
            useful: 4
          }
        ];
        saveLS(LS_KEYS.published, seed);
      }
    }

    // =========================================================
    // RENDER
    // =========================================================
    const publishedList = document.getElementById("publishedList");
    const pendingList = document.getElementById("pendingList");

    function escapeHTML(str){
      return (str || "").replace(/[&<>"']/g, m => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }

    function fmtDate(iso){
      try{
        const d = new Date(iso);
        return d.toLocaleDateString(undefined, {year:"numeric", month:"short", day:"numeric"});
      }catch(e){
        return "";
      }
    }

    function isAdmin(){
      return localStorage.getItem(LS_KEYS.admin) === "1";
    }

    function render(){
      const published = loadLS(LS_KEYS.published, []);
      const pending = loadLS(LS_KEYS.pending, []);
      const sortUseful = loadLS(LS_KEYS.usefulSort, false);

      // Sort published
      const pubs = [...published].sort((a,b)=>{
        if(sortUseful){
          return (b.useful||0) - (a.useful||0);
        }
        return new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime();
      });

      // Render published
      publishedList.innerHTML = pubs.length ? pubs.map(p => `
        <article class="post">
          <div class="post-top">
            <div>
              <h4>${escapeHTML(p.title)}</h4>
              <div class="small">
                <b>${escapeHTML(p.name || "Anonymous")}</b>
                ${p.location ? ` • ${escapeHTML(p.location)}` : ""}
                • ${fmtDate(p.createdAt)}
              </div>
            </div>
            <div class="badge">${escapeHTML(p.type)}</div>
          </div>

          <div class="body">${escapeHTML(p.body)}</div>

          <div class="post-actions">
            <button class="btn secondary tiny" type="button" onclick="voteUseful('${p.id}')">Useful • <span>${p.useful||0}</span></button>
            ${isAdmin() ? `<button class="btn secondary tiny" type="button" onclick="removePublished('${p.id}')">Remove</button>` : ``}
          </div>
        </article>
      `).join("") : `<div class="muted">No published notes yet. Be the first to submit one.</div>`;

      // Render pending
      pendingList.innerHTML = pending.length ? pending.map(p => `
        <article class="post" style="opacity:.95">
          <div class="post-top">
            <div>
              <h4>${escapeHTML(p.title)}</h4>
              <div class="small">
                <b>${escapeHTML(p.name || "Anonymous")}</b>
                ${p.location ? ` • ${escapeHTML(p.location)}` : ""}
                • ${fmtDate(p.createdAt)}
              </div>
            </div>
            <div class="badge">${escapeHTML(p.type)}</div>
          </div>

          <div class="body">${escapeHTML(p.body)}</div>

          <div class="post-actions">
            ${isAdmin()
              ? `<button class="btn tiny" type="button" onclick="approvePost('${p.id}')">Approve → Publish</button>
                 <button class="btn secondary tiny" type="button" onclick="rejectPost('${p.id}')">Reject</button>`
              : `<div class="muted">Pending moderation.</div>`
            }
          </div>
        </article>
      `).join("") : `<div class="muted">No pending submissions right now.</div>`;
    }

    // =========================================================
    // ACTIONS
    // =========================================================
    window.voteUseful = function(id){
      const published = loadLS(LS_KEYS.published, []);
      const idx = published.findIndex(p => p.id === id);
      if(idx >= 0){
        published[idx].useful = (published[idx].useful || 0) + 1;
        saveLS(LS_KEYS.published, published);
        render();
      }
    }

    window.approvePost = function(id){
      const pending = loadLS(LS_KEYS.pending, []);
      const published = loadLS(LS_KEYS.published, []);
      const idx = pending.findIndex(p => p.id === id);
      if(idx >= 0){
        published.unshift(pending[idx]);
        pending.splice(idx, 1);
        saveLS(LS_KEYS.pending, pending);
        saveLS(LS_KEYS.published, published);
        render();
      }
    }

    window.rejectPost = function(id){
      const pending = loadLS(LS_KEYS.pending, []);
      const idx = pending.findIndex(p => p.id === id);
      if(idx >= 0){
        pending.splice(idx, 1);
        saveLS(LS_KEYS.pending, pending);
        render();
      }
    }

    window.removePublished = function(id){
      const published = loadLS(LS_KEYS.published, []);
      const idx = published.findIndex(p => p.id === id);
      if(idx >= 0){
        published.splice(idx, 1);
        saveLS(LS_KEYS.published, published);
        render();
      }
    }

    // =========================================================
    // SUBMIT
    // =========================================================
    const fnType = document.getElementById("fnType");
    const fnName = document.getElementById("fnName");
    const fnLocation = document.getElementById("fnLocation");
    const fnTitle = document.getElementById("fnTitle");
    const fnBody = document.getElementById("fnBody");

    document.getElementById("submitNoteBtn").addEventListener("click", () => {
      const title = (fnTitle.value || "").trim();
      const body = (fnBody.value || "").trim();

      if(title.length < 6){
        alert("Give it a real title (at least 6 characters).");
        return;
      }
      if(body.length < 40){
        alert("Give enough detail to be useful (at least ~40 characters).");
        return;
      }

      const pending = loadLS(LS_KEYS.pending, []);
      pending.unshift({
        id: uid(),
        type: fnType.value,
        name: (fnName.value || "").trim(),
        location: (fnLocation.value || "").trim(),
        title,
        body,
        createdAt: nowISO(),
        useful: 0
      });
      saveLS(LS_KEYS.pending, pending);

      fnTitle.value = "";
      fnBody.value = "";
      alert("Submitted. It will appear after approval.");
      render();
    });

    document.getElementById("clearFormBtn").addEventListener("click", () => {
      fnType.value = "Survival Story";
      fnName.value = "";
      fnLocation.value = "";
      fnTitle.value = "";
      fnBody.value = "Scenario:\nWhat went wrong:\nWhat worked:\nLesson:";
    });

    // =========================================================
    // FILTER + ADMIN
    // =========================================================
    document.getElementById("filterAllBtn").addEventListener("click", () => {
      saveLS(LS_KEYS.usefulSort, false);
      render();
    });
    document.getElementById("filterUsefulBtn").addEventListener("click", () => {
      saveLS(LS_KEYS.usefulSort, true);
      render();
    });

    document.getElementById("openAdminBtn").addEventListener("click", () => {
      // Simple admin gate for local moderation demo
      // Replace this with real auth when you upgrade backend.
      const key = prompt("Admin key (local demo). Leave blank to cancel.");
      if(!key) return;

      // Change this to your own private string
      const ADMIN_KEY = "GRIT-ADMIN-KEY-CHANGE-ME";

      if(key === ADMIN_KEY){
        localStorage.setItem(LS_KEYS.admin, "1");
        alert("Admin enabled on this browser.");
      }else{
        alert("Wrong key.");
      }
      render();
    });

    // Init
    ensureSeed();
    // Pre-fill form body
    if(!fnBody.value){
      fnBody.value = "Scenario:\nWhat went wrong:\nWhat worked:\nLesson:";
    }
    render();
  </script>
</body>
</html>
